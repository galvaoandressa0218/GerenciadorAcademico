<div class="main-container">
  @if (matriz(); as m) {
    <main class="content-area">
      <header class="content-header">
        <div class="info">
          <h1>{{ m.nomeCurso || 'Engenharia de software' }}</h1>
          <p>Habilitação: {{ m.habilitacao }}</p>
          <p>Campus: {{ m.campus }} | Turno: {{ m.turno }}</p>
        </div>
        <button class="btn-organizar" (click)="openOrganizarModal()">Organizar Matrizes</button>
      </header>

      <div class="curriculum-accordion">
        @for(semestre of m.semestres; track semestre.semestre; let i = $index) {
          <div class="accordion-item">
            <app-barra-clique
              [title]="semestre.semestre + 'º Semestre'"
              [showArrow]="true"
              [estaAberta]="openSemesterIndex() === i"
              (barClicked)="toggleSemester(i)">
            </app-barra-clique>

            @if(openSemesterIndex() === i) {
              <div class="accordion-content">
                @for(d of semestre.disciplinas; track d.id) {
                  <div class="discipline-row">
                    <span class="discipline-name">{{ d.nome }} ({{ d.codigo }})</span>
                    <span>Bes</span>
                    <span>{{ d.cargaHoraria }}h</span>
                    <span>{{ d.tipo }}</span>
                    <span>{{ d.classificacao }}</span>
                  </div>
                } @empty {
                  <p class="empty-disciplines">Nenhuma disciplina associada a este semestre.</p>
                }
              </div>
            }
          </div>
        }
         <div class="accordion-item">
            <app-barra-clique [title]="'Opcionais / Eletivas'" [showArrow]="true"></app-barra-clique>
        </div>
      </div>
      
      <div class="complementary-hours">
        <div class="comp-header">
          <label>componentes complementares</label>
          <span>CH</span>
        </div>
        <input type="text" [value]="m.horasComplementares" readonly>
      </div>
    </main>
  } @else {
     <p>Carregando matriz curricular...</p>
  }
</div>

@if(isOrganizarModalVisible()) {
  <app-organizar-matriz
    [idMatriz]="matriz()?.id!"
    (close)="closeOrganizarModal()"
    (save)="handleSaveOrganizar($event)">
  </app-organizar-matriz>
}